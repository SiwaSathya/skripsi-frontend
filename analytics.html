<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Analytics - BaliAI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f0f0f; color: #e5e7eb; }
        .stat-card { background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(10px); }
        .chart-container { position: relative; height: 300px; width: 100%; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto mb-10 flex flex-col md:flex-row justify-between items-center gap-6">
        <div class="flex items-center gap-4">
            <a href="index.html" class="p-3 bg-white/5 rounded-xl border border-white/10 hover:bg-orange-600 transition-all">
                <i class="fa-solid fa-arrow-left"></i>
            </a>
            <div>
                <h1 class="text-2xl font-bold text-white">Research Analytics</h1>
                <p class="text-gray-500 text-sm italic">Data performa sistem Multi-Agent & Skala Guttman</p>
            </div>
        </div>
        <div id="last-update" class="text-[10px] uppercase tracking-widest text-gray-500 bg-white/5 px-4 py-2 rounded-full border border-white/5">
            Menghubungkan ke Database...
        </div>
    </div>

    <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
        <div class="stat-card p-6 rounded-3xl">
            <p class="text-[10px] text-gray-500 uppercase font-bold mb-1">Total Evaluasi</p>
            <h3 id="total-eval" class="text-3xl font-black text-orange-500">0</h3>
        </div>
        <div class="stat-card p-6 rounded-3xl">
            <p class="text-[10px] text-gray-500 uppercase font-bold mb-1">Avg. Satisfaction</p>
            <h3 id="avg-sat" class="text-3xl font-black text-blue-400">0.0</h3>
        </div>
        <div class="stat-card p-6 rounded-3xl">
            <p class="text-[10px] text-gray-500 uppercase font-bold mb-1">Avg. Response Time</p>
            <h3 id="avg-time" class="text-3xl font-black text-purple-400">0s</h3>
        </div>
        <div class="stat-card p-6 rounded-3xl">
            <p class="text-[10px] text-gray-500 uppercase font-bold mb-1">Total Word Count</p>
            <h3 id="total-words" class="text-3xl font-black text-green-400">0</h3>
        </div>
    </div>

    <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="stat-card p-8 rounded-[40px]">
            <h4 class="text-sm font-bold uppercase tracking-widest mb-6 flex items-center gap-2">
                <i class="fa-solid fa-square-poll-vertical text-orange-500"></i> Relevansi Model (Skala Guttman)
            </h4>
            <div class="chart-container">
                <canvas id="relevancyChart"></canvas>
            </div>
        </div>

        <div class="stat-card p-8 rounded-[40px]">
            <h4 class="text-sm font-bold uppercase tracking-widest mb-6 flex items-center gap-2">
                <i class="fa-solid fa-bolt text-yellow-500"></i> Tren Response Time (ms)
            </h4>
            <div class="chart-container">
                <canvas id="latencyChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const API_URL = "https://n8n.arcomteknologi.co.id/webhook/c7f2667b-4d30-4278-95a6-b3167b429778";

        async function fetchData() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                updateDashboard(data);
                document.getElementById('last-update').innerText = `Terakhir Update: ${new Date().toLocaleTimeString()}`;
            } catch (error) {
                console.error("Error fetching analytics:", error);
            }
        }

        function updateDashboard(data) {
            const count = data.length;
            if (count === 0) return;

            // Summary Stats
            let totalSat = 0;
            let totalTime = 0;
            let totalWords = 0;
            let relevancy = { ds: 0, ft: 0, gm: 0, cn: 0 };

            data.forEach(item => {
                totalSat += item.user_satisfaction;
                totalTime += item.response_time_ms;
                totalWords += item.word_count_total;
                relevancy.ds += item.is_relevant_deepseek;
                relevancy.ft += item.is_relevant_finetuned;
                relevancy.gm += item.is_relevant_gemini;
                relevancy.cn += item.is_relevant_conclusion;
            });

            document.getElementById('total-eval').innerText = count;
            document.getElementById('avg-sat').innerText = (totalSat / count).toFixed(1);
            document.getElementById('avg-time').innerText = ((totalTime / count) / 1000).toFixed(1) + 's';
            document.getElementById('total-words').innerText = totalWords.toLocaleString();

            // Relevancy Bar Chart
            const ctxRel = document.getElementById('relevancyChart').getContext('2d');
            new Chart(ctxRel, {
                type: 'bar',
                data: {
                    labels: ['DeepSeek', 'Fine-Tuned', 'Gemini', 'Conclusion'],
                    datasets: [{
                        label: 'Skala Guttman (Relevan)',
                        data: [relevancy.ds, relevancy.ft, relevancy.gm, relevancy.cn],
                        backgroundColor: ['#fb7185', '#60a5fa', '#a78bfa', '#4ade80'],
                        borderRadius: 12
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' } },
                        x: { grid: { display: false } }
                    }
                }
            });

            // Latency Line Chart
            const ctxLat = document.getElementById('latencyChart').getContext('2d');
            new Chart(ctxLat, {
                type: 'line',
                data: {
                    labels: data.map((_, i) => `S${i+1}`),
                    datasets: [{
                        label: 'Latency',
                        data: data.map(item => item.response_time_ms),
                        borderColor: '#fb923c',
                        backgroundColor: 'rgba(251, 146, 60, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.05)' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        window.onload = fetchData;
    </script>
</body>
</html>